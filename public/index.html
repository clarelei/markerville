<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MarkerVille</title>   
    <link rel="stylesheet" href="css/style.css"/>
    <!-- <link rel="stylesheet" type="text.css" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css"/> -->
    <script src="js/jquery.js"> </script>
    <script src="js/jquery-migrate-1.2.1.min.js"></script>
    <script src="js/result.js" defer></script>
    <script src="js/about.js" defer></script>
    <script src="js/forum.js" defer></script>
    <script src="js/database.js" defer></script>
    <script src="js/app.js" defer></script>
    <script src="js/main.js" defer></script>
    <script src="js/fetchData.js" defer></script>
    <script src="js/fetchForum.js" defer></script>
    <script src="js/jquery-migrate-1.2.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    </head>

      <body>
          <div class = "navBar">
              <div class = "button" id = "databaseButton" > Biomarker Search  </div>
              <div class = "button" id = "forumButton">  Forum </div>
              <div class = "button" id = "aboutButton"> About  </div>
          </div>

          <div id =  "forum" class="inactive">


          <div id = "forum-table-cont">
            <div id = "message-post-cont">
              <!-- onsubmit="return false" -->
            <form id="forumForm">
            <input type = "text" id = "message-post"  placeholder="Question here"onblur="this.placeholder='Question here'" onfocus="this.placeholder = ''"> </input>

          </form>
          </div>
            <table>
              <tr>
               <th> Questions
               <th> Answers
              </tr>
            </table>
            </div>


          </div>
          <div id =  "aboutPage" class="inactive">
            <p> Markerville is a web-hosted database that displays information about biomarkers.
            Allows users to search and edit existing information, while adding new entries of their own.
            We aim to create a community around biomarkers in the clinical research world and beyond. 

            We are powered by Snorkel, an NLP pipeline package written in Python and developed by Stanford's Info Lab.

            Developed by Mallick Lab at the Canary Center for Cancer Early Detection, Stanford University School of Medicine.
            Built with Node.js, Express, and MySQL. Thanks for visiting! More coming soon. </p>
            <div id = "aboutPic">
            <img id = "gautam" src = "images/gautam.jpg"></img>
          </div>
              <div class = "logo-cont">
            <img class = "logo" src = "images/logo.png"> </img>
          </div>
          </div>
          <div id = "result" class="inactive">
              <div id = "result-table-cont">

               <table class ="display">  
               <thead>
               <tr>
                <th> Biomarker Name
                <th> Biomarker Type
                <th> Disease 
                <th> Associated Drug
                <th> Medium
               </tr>
               </thead>
               <tbody>
                 <tr>
                 <td>
                 <td>
                 <td>
                 <td>
                 <td>
                 </tr>
               </tbody> 
                     
             </table>
          <!-- <script src="js/jquery.min.js"> </script>
          <script src="js/jquery.dataTables.min.js"></script>
          <script src="js/dataTables.jqueryui.min.js"></script> -->
               <script type="text/javascript">
//                 $(document).ready(function(){
//                   $('#result table').DataTable();
//                 });
                 //
// Pipelining function for DataTables. To be used to the `ajax` option of DataTables
//
$.fn.dataTable.pipeline = function ( opts ) {
    // Configuration options
    var conf = $.extend( {
        pages: 5,     // number of pages to cache
        url: '',      // script url
        data: null,   // function or object with parameters to send to the server
                      // matching how `ajax.data` works in DataTables
        method: 'GET' // Ajax HTTP method
    }, opts );
 
    // Private variables for storing the cache
    var cacheLower = -1;
    var cacheUpper = null;
    var cacheLastRequest = null;
    var cacheLastJson = null;
 
    return function ( request, drawCallback, settings ) {
        var ajax          = false;
        var requestStart  = request.start;
        var drawStart     = request.start;
        var requestLength = request.length;
        var requestEnd    = requestStart + requestLength;
         
        if ( settings.clearCache ) {
            // API requested that the cache be cleared
            ajax = true;
            settings.clearCache = false;
        }
        else if ( cacheLower < 0 || requestStart < cacheLower || requestEnd > cacheUpper ) {
            // outside cached data - need to make a request
            ajax = true;
        }
        else if ( JSON.stringify( request.order )   !== JSON.stringify( cacheLastRequest.order ) ||
                  JSON.stringify( request.columns ) !== JSON.stringify( cacheLastRequest.columns ) ||
                  JSON.stringify( request.search )  !== JSON.stringify( cacheLastRequest.search )
        ) {
            // properties changed (ordering, columns, searching)
            ajax = true;
        }
         
        // Store the request for checking next time around
        cacheLastRequest = $.extend( true, {}, request );
 
        if ( ajax ) {
            // Need data from the server
            if ( requestStart < cacheLower ) {
                requestStart = requestStart - (requestLength*(conf.pages-1));
 
                if ( requestStart < 0 ) {
                    requestStart = 0;
                }
            }
             
            cacheLower = requestStart;
            cacheUpper = requestStart + (requestLength * conf.pages);
 
            request.start = requestStart;
            request.length = requestLength*conf.pages;
 
            // Provide the same `data` options as DataTables.
            if ( $.isFunction ( conf.data ) ) {
                // As a function it is executed with the data object as an arg
                // for manipulation. If an object is returned, it is used as the
                // data object to submit
                var d = conf.data( request );
                if ( d ) {
                    $.extend( request, d );
                }
            }
            else if ( $.isPlainObject( conf.data ) ) {
                // As an object, the data given extends the default
                $.extend( request, conf.data );
            }
 
            settings.jqXHR = $.ajax( {
                "type":     conf.method,
                "url":      conf.url,
                "data":     request,
                "dataType": "json",
                "cache":    false,
                "success":  function ( json ) {
                    cacheLastJson = $.extend(true, {}, json);
 
                    if ( cacheLower != drawStart ) {
                        json.data.splice( 0, drawStart-cacheLower );
                    }
                    if ( requestLength >= -1 ) {
                        json.data.splice( requestLength, json.data.length );
                    }
                     
                    drawCallback( json );
                }
            } );
        }
        else {
            json = $.extend( true, {}, cacheLastJson );
            json.draw = request.draw; // Update the echo for each response
            json.data.splice( 0, requestStart-cacheLower );
            json.data.splice( requestLength, json.data.length );
 
            drawCallback(json);
        }
    }
};
 
// Register an API method that will empty the pipelined data, forcing an Ajax
// fetch on the next draw (i.e. `table.clearPipeline().draw()`)
$.fn.dataTable.Api.register( 'clearPipeline()', function () {
    return this.iterator( 'table', function ( settings ) {
        settings.clearCache = true;
    } );
} );
 
 
//
// DataTables initialisation
//
$(document).ready(function() {
    $('#result table').DataTable( {
        "processing": true,
        "serverSide": true,
        "ajax": $.fn.dataTable.pipeline( {
            url: 'js/server_processing.php',
            pages: 5 // number of pages to cache
        } )
    } );
} );
              </script>

           </div>
          </div>

          <div id = "database">

              <p> Welcome to MarkerVille! <br>Search by biomarker, drug, or cancer type: </p>
              <div>
                <!-- onsubmit="return false" -->

              <form id="searchForm">
                <input type= "text" id="word-input" placeholder="Enter search here"onblur="this.placeholder='Enter search here'" onfocus="this.placeholder = ''"/>
              </form>
              </div>
              <div class = "logo-cont">
                <img class="logo" src = "images/logo.png"> </img>
              </div>
        </div>

  </body>
</html>
